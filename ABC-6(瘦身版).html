<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>7x7 Lab - 像素文字生成器</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Arial, sans-serif;
        }
        
        body {
            background-color: #121212;
            color: #e0e0e0;
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 1px solid #333;
        }
        
        h1 {
            font-size: 2.5rem;
            color: #fff;
            margin-bottom: 10px;
            letter-spacing: 2px;
        }
        
        .subtitle {
            color: #aaa;
            font-size: 1.1rem;
        }
        
        .main-content {
            display: flex;
            flex-wrap: wrap;
            gap: 30px;
            margin-bottom: 30px;
        }
        
        .control-panel {
            flex: 1;
            min-width: 300px;
            background-color: #1e1e1e;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(255, 255, 255, 0.05);
        }
        
        .preview-container {
            flex: 2;
            min-width: 400px;
            background-color: #1e1e1e;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(255, 255, 255, 0.05);
        }
        
        .section-title {
            font-size: 1.3rem;
            margin-bottom: 15px;
            color: #fff;
            border-bottom: 1px solid #333;
            padding-bottom: 8px;
        }
        
        .input-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
        }
        
        input, select, button {
            width: 100%;
            padding: 10px;
            background-color: #2d2d2d;
            border: 1px solid #444;
            border-radius: 5px;
            color: #fff;
            font-size: 1rem;
        }
        
        button {
            background-color: #3a3a3a;
            color: white;
            border: none;
            cursor: pointer;
            transition: background-color 0.3s;
            font-weight: 600;
            margin-top: 5px;
        }
        
        button:hover {
            background-color: #4a4a4a;
        }
        
        .button-primary {
            background-color: #4CAF50;
        }
        
        .button-primary:hover {
            background-color: #3d8b40;
        }
        
        .preview-area {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 300px;
            background-color: #2d2d2d;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .font-preview {
            font-family: monospace;
            font-size: 1.5rem;
            line-height: 1.8;
            white-space: pre;
            color: #4CAF50;
            text-align: center;
        }
        
        .action-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 15px;
        }
        
        .char-buttons {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
            margin-top: 15px;
        }
        
        @media (max-width: 768px) {
            .main-content {
                flex-direction: column;
            }
            
            .control-panel, .preview-container {
                min-width: 100%;
            }
            
            .action-buttons {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>7x7 lab</h1>
            <p class="subtitle">像素文字 G-code 生成器</p>
        </header>
        
        <div class="main-content">
            <div class="control-panel">
                <h2 class="section-title">控制面板</h2>
                
                <div class="input-group">
                    <label for="textInput">輸入文字 (大寫字母、小寫字母和數字):</label>
                    <input type="text" id="textInput" maxlength="10" placeholder="例如: NFU">
                </div>
                
                <div class="input-group">
                    <label>快速範例:</label>
                    <div class="char-buttons">
                        <button data-char="NFU">NFU</button>
                        <button data-char="ABC">ABC</button>
                        <button data-char="Hello">Hello</button>
                        <button data-char="123">123</button>
                        <button data-char="3D PRINT">3D PRINT</button>
                        <button data-char="LAB">LAB</button>
                        <button data-char="Open">Open</button>
                        <button data-char="Source">Source</button>
                    </div>
                </div>
                
                <div class="input-group">
                    <label for="pixelSize">像素尺寸 (mm):</label>
                    <input type="number" id="pixelSize" value="5.0" min="1" max="20" step="0.5">
                </div>
                
                <div class="input-group">
                    <label for="blockHeight">厚度 (mm):</label>
                    <input type="number" id="blockHeight" value="2.0" min="0.5" max="10" step="0.5">
                </div>
                
                <div class="input-group">
                    <label for="printStyle">列印樣式:</label>
                    <select id="printStyle">
                        <option value="solid">實心</option>
                        <option value="hollow">空心</option>
                    </select>
                </div>
                
                <div class="action-buttons">
                    <button id="copyBtn" class="button-primary">複製 G-code</button>
                    <button id="downloadBtn" class="button-primary">下載 G-code</button>
                </div>
            </div>
            
            <div class="preview-container">
                <h2 class="section-title">字型預覽</h2>
                <div class="preview-area">
                    <div class="font-preview" id="fontPreview">
                        輸入文字以顯示預覽
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 字元定義 (7x7 像素) - 保留所有字元定義
        const charMap = {
            'A': [
                [0,0,1,1,1,0,0],
                [0,1,0,0,0,1,0],
                [1,0,0,0,0,0,1],
                [1,1,1,1,1,1,1],
                [1,0,0,0,0,0,1],
                [1,0,0,0,0,0,1],
                [1,0,0,0,0,0,1]
            ],
            'B': [
                [1,1,1,1,1,1,0],
                [1,0,0,0,0,0,1],
                [1,0,0,0,0,0,1],
                [1,1,1,1,1,1,0],
                [1,0,0,0,0,0,1],
                [1,0,0,0,0,0,1],
                [1,1,1,1,1,1,0]
            ],
            'C': [
                [0,1,1,1,1,1,0],
                [1,0,0,0,0,0,1],
                [1,0,0,0,0,0,0],
                [1,0,0,0,0,0,0],
                [1,0,0,0,0,0,0],
                [1,0,0,0,0,0,1],
                [0,1,1,1,1,1,0]
            ],
            'D': [
                [1,1,1,1,1,1,0],
                [1,0,0,0,0,0,1],
                [1,0,0,0,0,0,1],
                [1,0,0,0,0,0,1],
                [1,0,0,0,0,0,1],
                [1,0,0,0,0,0,1],
                [1,1,1,1,1,1,0]
            ],
            'E': [
                [1,1,1,1,1,1,1],
                [1,0,0,0,0,0,0],
                [1,0,0,0,0,0,0],
                [1,1,1,1,1,1,0],
                [1,0,0,0,0,0,0],
                [1,0,0,0,0,0,0],
                [1,1,1,1,1,1,1]
            ],
            'F': [
                [1,1,1,1,1,1,1],
                [1,0,0,0,0,0,0],
                [1,0,0,0,0,0,0],
                [1,1,1,1,1,1,0],
                [1,0,0,0,0,0,0],
                [1,0,0,0,0,0,0],
                [1,0,0,0,0,0,0]
            ],
            'G': [
                [0,1,1,1,1,1,0],
                [1,0,0,0,0,0,1],
                [1,0,0,0,0,0,0],
                [1,0,0,1,1,1,1],
                [1,0,0,0,0,0,1],
                [1,0,0,0,0,0,1],
                [0,1,1,1,1,1,0]
            ],
            'H': [
                [1,0,0,0,0,0,1],
                [1,0,0,0,0,0,1],
                [1,0,0,0,0,0,1],
                [1,1,1,1,1,1,1],
                [1,0,0,0,0,0,1],
                [1,0,0,0,0,0,1],
                [1,0,0,0,0,0,1]
            ],
            'I': [
                [1,1,1,1,1,1,1],
                [0,0,0,1,0,0,0],
                [0,0,0,1,0,0,0],
                [0,0,0,1,0,0,0],
                [0,0,0,1,0,0,0],
                [0,0,0,1,0,0,0],
                [1,1,1,1,1,1,1]
            ],
            'J': [
                [0,0,0,0,0,0,1],
                [0,0,0,0,0,0,1],
                [0,0,0,0,0,0,1],
                [0,0,0,0,0,0,1],
                [1,0,0,0,0,0,1],
                [1,0,0,0,0,0,1],
                [0,1,1,1,1,1,0]
            ],
            'K': [
                [1,0,0,0,0,1,0],
                [1,0,0,0,1,0,0],
                [1,0,0,1,0,0,0],
                [1,1,1,0,0,0,0],
                [1,0,0,1,0,0,0],
                [1,0,0,0,1,0,0],
                [1,0,0,0,0,1,0]
            ],
            'L': [
                [1,0,0,0,0,0,0],
                [1,0,0,0,0,0,0],
                [1,0,0,0,0,0,0],
                [1,0,0,0,0,0,0],
                [1,0,0,0,0,0,0],
                [1,0,0,0,0,0,0],
                [1,1,1,1,1,1,1]
            ],
            'M': [
                [1,0,0,0,0,0,1],
                [1,1,0,0,0,1,1],
                [1,0,1,0,1,0,1],
                [1,0,0,1,0,0,1],
                [1,0,0,0,0,0,1],
                [1,0,0,0,0,0,1],
                [1,0,0,0,0,0,1]
            ],
            'N': [
                [1,0,0,0,0,0,1],
                [1,1,0,0,0,0,1],
                [1,0,1,0,0,0,1],
                [1,0,0,1,0,0,1],
                [1,0,0,0,1,0,1],
                [1,0,0,0,0,1,1],
                [1,0,0,0,0,0,1]
            ],
            'O': [
                [0,1,1,1,1,1,0],
                [1,0,0,0,0,0,1],
                [1,0,0,0,0,0,1],
                [1,0,0,0,0,0,1],
                [1,0,0,0,0,0,1],
                [1,0,0,0,0,0,1],
                [0,1,1,1,1,1,0]
            ],
            'P': [
                [1,1,1,1,1,1,0],
                [1,0,0,0,0,0,1],
                [1,0,0,0,0,0,1],
                [1,1,1,1,1,1,0],
                [1,0,0,0,0,0,0],
                [1,0,0,0,0,0,0],
                [1,0,0,0,0,0,0]
            ],
            'Q': [
                [0,1,1,1,1,1,0],
                [1,0,0,0,0,0,1],
                [1,0,0,0,0,0,1],
                [1,0,0,0,0,0,1],
                [1,0,0,1,0,0,1],
                [1,0,0,0,1,0,1],
                [0,1,1,1,1,1,1]
            ],
            'R': [
                [1,1,1,1,1,1,0],
                [1,0,0,0,0,0,1],
                [1,0,0,0,0,0,1],
                [1,1,1,1,1,1,0],
                [1,0,0,1,0,0,0],
                [1,0,0,0,1,0,0],
                [1,0,0,0,0,1,0]
            ],
            'S': [
                [0,1,1,1,1,1,0],
                [1,0,0,0,0,0,1],
                [1,0,0,0,0,0,0],
                [0,1,1,1,1,1,0],
                [0,0,0,0,0,0,1],
                [1,0,0,0,0,0,1],
                [0,1,1,1,1,1,0]
            ],
            'T': [
                [1,1,1,1,1,1,1],
                [0,0,0,1,0,0,0],
                [0,0,0,1,0,0,0],
                [0,0,0,1,0,0,0],
                [0,0,0,1,0,0,0],
                [0,0,0,1,0,0,0],
                [0,0,0,1,0,0,0]
            ],
            'U': [
                [1,0,0,0,0,0,1],
                [1,0,0,0,0,0,1],
                [1,0,0,0,0,0,1],
                [1,0,0,0,0,0,1],
                [1,0,0,0,0,0,1],
                [1,0,0,0,0,0,1],
                [0,1,1,1,1,1,0]
            ],
            'V': [
                [1,0,0,0,0,0,1],
                [1,0,0,0,0,0,1],
                [1,0,0,0,0,0,1],
                [1,0,0,0,0,0,1],
                [0,1,0,0,0,1,0],
                [0,0,1,0,1,0,0],
                [0,0,0,1,0,0,0]
            ],
            'W': [
                [1,0,0,0,0,0,1],
                [1,0,0,0,0,0,1],
                [1,0,0,0,0,0,1],
                [1,0,0,1,0,0,1],
                [1,0,1,0,1,0,1],
                [1,1,0,0,0,1,1],
                [1,0,0,0,0,0,1]
            ],
            'X': [
                [1,0,0,0,0,0,1],
                [0,1,0,0,0,1,0],
                [0,0,1,0,1,0,0],
                [0,0,0,1,0,0,0],
                [0,0,1,0,1,0,0],
                [0,1,0,0,0,1,0],
                [1,0,0,0,0,0,1]
            ],
            'Y': [
                [1,0,0,0,0,0,1],
                [0,1,0,0,0,1,0],
                [0,0,1,0,1,0,0],
                [0,0,0,1,0,0,0],
                [0,0,0,1,0,0,0],
                [0,0,0,1,0,0,0],
                [0,0,0,1,0,0,0]
            ],
            'Z': [
                [1,1,1,1,1,1,1],
                [0,0,0,0,0,1,0],
                [0,0,0,0,1,0,0],
                [0,0,0,1,0,0,0],
                [0,0,1,0,0,0,0],
                [0,1,0,0,0,0,0],
                [1,1,1,1,1,1,1]
            ],
            '0': [
                [0,1,1,1,1,1,0],
                [1,0,0,0,0,0,1],
                [1,0,0,0,1,0,1],
                [1,0,0,1,0,0,1],
                [1,0,1,0,0,0,1],
                [1,0,0,0,0,0,1],
                [0,1,1,1,1,1,0]
            ],
            '1': [
                [0,0,0,1,0,0,0],
                [0,0,1,1,0,0,0],
                [0,0,0,1,0,0,0],
                [0,0,0,1,0,0,0],
                [0,0,0,1,0,0,0],
                [0,0,0,1,0,0,0],
                [0,1,1,1,1,1,0]
            ],
            '2': [
                [0,1,1,1,1,1,0],
                [1,0,0,0,0,0,1],
                [0,0,0,0,0,0,1],
                [0,0,0,1,1,1,0],
                [0,1,1,0,0,0,0],
                [1,0,0,0,0,0,0],
                [1,1,1,1,1,1,1]
            ],
            '3': [
                [0,1,1,1,1,1,0],
                [1,0,0,0,0,0,1],
                [0,0,0,0,0,0,1],
                [0,0,1,1,1,1,0],
                [0,0,0,0,0,0,1],
                [1,0,0,0,0,0,1],
                [0,1,1,1,1,1,0]
            ],
            '4': [
                [0,0,0,0,1,0,0],
                [0,0,0,1,1,0,0],
                [0,0,1,0,1,0,0],
                [0,1,0,0,1,0,0],
                [1,1,1,1,1,1,1],
                [0,0,0,0,1,0,0],
                [0,0,0,0,1,0,0]
            ],
            '5': [
                [1,1,1,1,1,1,1],
                [1,0,0,0,0,0,0],
                [1,0,0,0,0,0,0],
                [1,1,1,1,1,1,0],
                [0,0,0,0,0,0,1],
                [1,0,0,0,0,0,1],
                [0,1,1,1,1,1,0]
            ],
            '6': [
                [0,1,1,1,1,1,0],
                [1,0,0,0,0,0,1],
                [1,0,0,0,0,0,0],
                [1,1,1,1,1,1,0],
                [1,0,0,0,0,0,1],
                [1,0,0,0,0,0,1],
                [0,1,1,1,1,1,0]
            ],
            '7': [
                [1,1,1,1,1,1,1],
                [0,0,0,0,0,0,1],
                [0,0,0,0,0,1,0],
                [0,0,0,0,1,0,0],
                [0,0,0,1,0,0,0],
                [0,0,1,0,0,0,0],
                [0,0,1,0,0,0,0]
            ],
            '8': [
                [0,1,1,1,1,1,0],
                [1,0,0,0,0,0,1],
                [1,0,0,0,0,0,1],
                [0,1,1,1,1,1,0],
                [1,0,0,0,0,0,1],
                [1,0,0,0,0,0,1],
                [0,1,1,1,1,1,0]
            ],
            '9': [
                [0,1,1,1,1,1,0],
                [1,0,0,0,0,0,1],
                [1,0,0,0,0,0,1],
                [0,1,1,1,1,1,1],
                [0,0,0,0,0,0,1],
                [1,0,0,0,0,0,1],
                [0,1,1,1,1,1,0]
            ],
            'a': [
                [0,0,0,0,0,0,0],
                [0,0,0,0,0,0,0],
                [0,1,1,1,1,0,0],
                [0,0,0,0,0,1,0],
                [0,1,1,1,1,1,0],
                [1,0,0,0,0,1,0],
                [0,1,1,1,1,1,0]
            ],
            'b': [
                [1,0,0,0,0,0,0],
                [1,0,0,0,0,0,0],
                [1,0,1,1,1,0,0],
                [1,1,0,0,0,1,0],
                [1,0,0,0,0,1,0],
                [1,1,0,0,0,1,0],
                [1,0,1,1,1,0,0]
            ],
            'c': [
                [0,0,0,0,0,0,0],
                [0,0,0,0,0,0,0],
                [0,1,1,1,1,0,0],
                [1,0,0,0,0,1,0],
                [1,0,0,0,0,0,0],
                [1,0,0,0,0,1,0],
                [0,1,1,1,1,0,0]
            ],
            'd': [
                [0,0,0,0,0,0,1],
                [0,0,0,0,0,0,1],
                [0,1,1,1,0,0,1],
                [1,0,0,0,1,0,1],
                [1,0,0,0,0,0,1],
                [1,0,0,0,1,0,1],
                [0,1,1,1,0,0,1]
            ],
            'e': [
                [0,0,0,0,0,0,0],
                [0,0,0,0,0,0,0],
                [0,1,1,1,1,0,0],
                [1,0,0,0,0,1,0],
                [1,1,1,1,1,1,0],
                [1,0,0,0,0,0,0],
                [0,1,1,1,1,0,0]
            ],
            'f': [
                [0,0,1,1,1,0,0],
                [0,1,0,0,0,1,0],
                [0,1,0,0,0,0,0],
                [1,1,1,1,0,0,0],
                [0,1,0,0,0,0,0],
                [0,1,0,0,0,0,0],
                [0,1,0,0,0,0,0]
            ],
            'g': [
                [0,0,0,0,0,0,0],
                [0,1,1,1,1,0,0],
                [1,0,0,0,0,1,0],
                [1,0,0,0,0,1,0],
                [0,1,1,1,1,1,0],
                [0,0,0,0,0,1,0],
                [0,1,1,1,1,0,0]
            ],
            'h': [
                [1,0,0,0,0,0,0],
                [1,0,0,0,0,0,0],
                [1,0,1,1,1,0,0],
                [1,1,0,0,0,1,0],
                [1,0,0,0,0,1,0],
                [1,0,0,0,0,1,0],
                [1,0,0,0,0,1,0]
            ],
            'i': [
                [0,0,1,0,0,0,0],
                [0,0,0,0,0,0,0],
                [0,1,1,0,0,0,0],
                [0,0,1,0,0,0,0],
                [0,0,1,0,0,0,0],
                [0,0,1,0,0,0,0],
                [0,1,1,1,0,0,0]
            ],
            'j': [
                [0,0,0,0,1,0,0],
                [0,0,0,0,0,0,0],
                [0,0,0,1,1,0,0],
                [0,0,0,0,1,0,0],
                [0,0,0,0,1,0,0],
                [1,0,0,0,1,0,0],
                [0,1,1,1,0,0,0]
            ],
            'k': [
                [1,0,0,0,0,0,0],
                [1,0,0,0,0,0,0],
                [1,0,0,0,1,0,0],
                [1,0,0,1,0,0,0],
                [1,1,1,0,0,0,0],
                [1,0,0,1,0,0,0],
                [1,0,0,0,1,0,0]
            ],
            'l': [
                [0,1,1,0,0,0,0],
                [0,0,1,0,0,0,0],
                [0,0,1,0,0,0,0],
                [0,0,1,0,0,0,0],
                [0,0,1,0,0,0,0],
                [0,0,1,0,0,0,0],
                [0,1,1,1,0,0,0]
            ],
            'm': [
                [0,0,0,0,0,0,0],
                [0,0,0,0,0,0,0],
                [1,1,0,1,0,0,0],
                [1,0,1,0,1,0,0],
                [1,0,1,0,1,0,0],
                [1,0,1,0,1,0,0],
                [1,0,1,0,1,0,0]
            ],
            'n': [
                [0,0,0,0,0,0,0],
                [0,0,0,0,0,0,0],
                [1,0,1,1,0,0,0],
                [1,1,0,0,1,0,0],
                [1,0,0,0,1,0,0],
                [1,0,0,0,1,0,0],
                [1,0,0,0,1,0,0]
            ],
            'o': [
                [0,0,0,0,0,0,0],
                [0,0,0,0,0,0,0],
                [0,1,1,1,0,0,0],
                [1,0,0,0,1,0,0],
                [1,0,0,0,1,0,0],
                [1,0,0,0,1,0,0],
                [0,1,1,1,0,0,0]
            ],
            'p': [
                [0,0,0,0,0,0,0],
                [0,0,0,0,0,0,0],
                [1,1,1,1,0,0,0],
                [1,0,0,0,1,0,0],
                [1,1,1,1,0,0,0],
                [1,0,0,0,0,0,0],
                [1,0,0,0,0,0,0]
            ],
            'q': [
                [0,0,0,0,0,0,0],
                [0,0,0,0,0,0,0],
                [0,1,1,1,0,0,0],
                [1,0,0,0,1,0,0],
                [0,1,1,1,1,0,0],
                [0,0,0,0,1,0,0],
                [0,0,0,0,1,0,0]
            ],
            'r': [
                [0,0,0,0,0,0,0],
                [0,0,0,0,0,0,0],
                [1,0,1,1,0,0,0],
                [1,1,0,0,1,0,0],
                [1,0,0,0,0,0,0],
                [1,0,0,0,0,0,0],
                [1,0,0,0,0,0,0]
            ],
            's': [
                [0,0,0,0,0,0,0],
                [0,0,0,0,0,0,0],
                [0,1,1,1,1,0,0],
                [1,0,0,0,0,0,0],
                [0,1,1,1,0,0,0],
                [0,0,0,0,1,0,0],
                [1,1,1,1,0,0,0]
            ],
            't': [
                [0,0,1,0,0,0,0],
                [0,0,1,0,0,0,0],
                [0,1,1,1,0,0,0],
                [0,0,1,0,0,0,0],
                [0,0,1,0,0,0,0],
                [0,0,1,0,1,0,0],
                [0,0,0,1,0,0,0]
            ],
            'u': [
                [0,0,0,0,0,0,0],
                [0,0,0,0,0,0,0],
                [1,0,0,0,1,0,0],
                [1,0,0,0,1,0,0],
                [1,0,0,0,1,0,0],
                [1,0,0,1,1,0,0],
                [0,1,1,0,1,0,0]
            ],
            'v': [
                [0,0,0,0,0,0,0],
                [0,0,0,0,0,0,0],
                [1,0,0,0,1,0,0],
                [1,0,0,0,1,0,0],
                [1,0,0,0,1,0,0],
                [0,1,0,1,0,0,0],
                [0,0,1,0,0,0,0]
            ],
            'w': [
                [0,0,0,0,0,0,0],
                [0,0,0,0,0,0,0],
                [1,0,0,0,1,0,0],
                [1,0,0,0,1,0,0],
                [1,0,1,0,1,0,0],
                [1,0,1,0,1,0,0],
                [0,1,0,1,0,0,0]
            ],
            'x': [
                [0,0,0,0,0,0,0],
                [0,0,0,0,0,0,0],
                [1,0,0,0,1,0,0],
                [0,1,0,1,0,0,0],
                [0,0,1,0,0,0,0],
                [0,1,0,1,0,0,0],
                [1,0,0,0,1,0,0]
            ],
            'y': [
                [0,0,0,0,0,0,0],
                [0,0,0,0,0,0,0],
                [1,0,0,0,1,0,0],
                [1,0,0,0,1,0,0],
                [0,1,1,1,1,0,0],
                [0,0,0,0,1,0,0],
                [0,1,1,1,0,0,0]
            ],
            'z': [
                [0,0,0,0,0,0,0],
                [0,0,0,0,0,0,0],
                [1,1,1,1,1,0,0],
                [0,0,0,1,0,0,0],
                [0,0,1,0,0,0,0],
                [0,1,0,0,0,0,0],
                [1,1,1,1,1,0,0]
            ],
            ' ': [
                [0,0,0,0,0,0,0],
                [0,0,0,0,0,0,0],
                [0,0,0,0,0,0,0],
                [0,0,0,0,0,0,0],
                [0,0,0,0,0,0,0],
                [0,0,0,0,0,0,0],
                [0,0,0,0,0,0,0]
            ]
        };

        // 顯示字型預覽
        function showFontPreview() {
            const text = document.getElementById('textInput').value;
            const preview = document.getElementById('fontPreview');
            
            if (!text) {
                preview.textContent = "輸入文字以顯示預覽";
                return;
            }
            
            let previewText = '';
            
            for (let row = 0; row < 7; row++) {
                let line = '';
                for (let charIndex = 0; charIndex < text.length; charIndex++) {
                    const char = text[charIndex];
                    if (charMap[char]) {
                        for (let col = 0; col < 7; col++) {
                            line += charMap[char][row][col] === 1 ? '■' : '□';
                        }
                        line += '  '; // 字元間距
                    }
                }
                previewText += line + '\n';
            }
            
            preview.textContent = previewText;
        }

        // 生成 G-code
        function generateGcode() {
            const text = document.getElementById('textInput').value;
            const pixelSize = parseFloat(document.getElementById('pixelSize').value);
            const blockHeight = parseFloat(document.getElementById('blockHeight').value);
            const printStyle = document.getElementById('printStyle').value;
            
            // 固定參數
            const printSpeed = 60;
            const nozzleTemp = 220;
            const bedTemp = 80;
            const layerHeight = 0.2;
            const layers = Math.round(blockHeight / layerHeight);
            
            let gcode = `; 像素風格3D列印G-code\n`;
            gcode += `; 文字: ${text}\n`;
            gcode += `; 像素尺寸: ${pixelSize}mm\n`;
            gcode += `; 厚度: ${blockHeight}mm\n`;
            gcode += `; 列印樣式: ${printStyle === 'solid' ? '實心' : '空心'}\n`;
            gcode += `; 列印速度: ${printSpeed}mm/s\n`;
            gcode += `; 噴頭溫度: ${nozzleTemp}°C\n`;
            gcode += `; 熱床溫度: ${bedTemp}°C\n`;
            gcode += `; 層高: ${layerHeight}mm\n\n`;
            
            // G-code 初始化設定
            gcode += `; 初始化設定\n`;
            gcode += `G21 ; 毫米單位\n`;
            gcode += `G90 ; 絕對座標\n`;
            gcode += `M82 ; 絕對擠出\n\n`;
            
            // 加熱設定
            gcode += `; 加熱設定\n`;
            gcode += `M104 S${nozzleTemp} ; 設定噴頭溫度\n`;
            gcode += `M140 S${bedTemp} ; 設定熱床溫度\n\n`;
            
            // 等待加熱
            gcode += `; 等待加熱\n`;
            gcode += `M190 S${bedTemp} ; 等待熱床達到溫度\n`;
            gcode += `M109 S${nozzleTemp} ; 等待噴頭達到溫度\n\n`;
            
            // 初始移動
            gcode += `; 初始移動\n`;
            gcode += `G28 ; 所有軸歸零\n`;
            gcode += `G1 Z5 F3000 ; 抬升噴頭\n\n`;
            
            // 開始列印像素方塊
            gcode += `; 開始列印像素方塊\n`;
            gcode += `; 總層數: ${layers}\n\n`;
            
            // 生成每個字元的像素位置
            let xOffset = 10;
            
            for (let charIndex = 0; charIndex < text.length; charIndex++) {
                const char = text[charIndex];
                
                if (charMap[char]) {
                    // 計算字元位置
                    const charX = xOffset;
                    
                    // 生成每個像素方塊
                    for (let row = 0; row < 7; row++) {
                        for (let col = 0; col < 7; col++) {
                            if (charMap[char][row][col] === 1) {
                                const x = charX + col * pixelSize;
                                const y = 10 + (6 - row) * pixelSize; // 修正Y軸方向
                                
                                // 為每個方塊生成所有層
                                for (let layer = 1; layer <= layers; layer++) {
                                    const z = layer * layerHeight;
                                    
                                    gcode += `; 第 ${layer} 層, Z=${z.toFixed(2)}mm\n`;
                                    gcode += `G1 Z${z.toFixed(2)} F3000\n`;
                                    gcode += `G1 X${x.toFixed(2)} Y${y.toFixed(2)} F3000\n`;
                                    gcode += `G1 E0.4 F300 ; 開始擠出\n`;
                                    
                                    if (printStyle === 'solid') {
                                        // 實心方塊 - 填充內部
                                        gcode += `; 實心方塊填充\n`;
                                        for (let fillRow = 0; fillRow <= pixelSize; fillRow += pixelSize/4) {
                                            const fillY = y + fillRow;
                                            gcode += `G1 X${x.toFixed(2)} Y${fillY.toFixed(2)} E0.2 F${printSpeed}\n`;
                                            gcode += `G1 X${(x + pixelSize).toFixed(2)} Y${fillY.toFixed(2)} E0.2\n`;
                                        }
                                    } else {
                                        // 空心方塊 - 只繪製輪廓
                                        gcode += `; 空心方塊輪廓\n`;
                                        gcode += `G1 X${(x + pixelSize).toFixed(2)} Y${y.toFixed(2)} E0.8 F${printSpeed}\n`;
                                        gcode += `G1 X${(x + pixelSize).toFixed(2)} Y${(y + pixelSize).toFixed(2)} E0.8\n`;
                                        gcode += `G1 X${x.toFixed(2)} Y${(y + pixelSize).toFixed(2)} E0.8\n`;
                                        gcode += `G1 X${x.toFixed(2)} Y${y.toFixed(2)} E0.8\n`;
                                    }
                                    
                                    gcode += `G1 E-0.4 F1800 ; 回抽\n\n`;
                                }
                            }
                        }
                    }
                    
                    xOffset += 8 * pixelSize; // 字元間距
                }
            }
            
            // 列印完成
            gcode += `; 列印完成\n`;
            gcode += `G1 Z10 F3000 ; 抬升噴頭\n`;
            gcode += `M104 S0 ; 關閉噴頭加熱\n`;
            gcode += `M140 S0 ; 關閉熱床加熱\n`;
            gcode += `G28 X Y ; X/Y軸歸零\n`;
            gcode += `M84 ; 關閉步進馬達\n`;
            gcode += `M30 ; 程式結束\n`;
            
            return gcode;
        }

        // 複製 G-code 到剪貼簿
        function copyGcode() {
            const text = document.getElementById('textInput').value;
            if (!text || text.trim() === '') {
                alert('請輸入有效的文字！');
                return;
            }
            
            const gcode = generateGcode();
            
            navigator.clipboard.writeText(gcode).then(() => {
                alert('G-code 已複製到剪貼簿！');
            }).catch(err => {
                console.error('複製失敗: ', err);
                alert('複製失敗，請手動複製文字');
            });
        }

        // 下載 G-code 檔案
        function downloadGcode() {
            const text = document.getElementById('textInput').value;
            if (!text || text.trim() === '') {
                alert('請輸入有效的文字！');
                return;
            }
            
            const gcode = generateGcode();
            const cleanText = text.replace(/[^a-zA-Z0-9]/g, '_');
            const blob = new Blob([gcode], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `pixel_${cleanText}.gcode`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // 初始化
        document.addEventListener('DOMContentLoaded', () => {
            // 事件監聽器
            document.getElementById('copyBtn').addEventListener('click', copyGcode);
            document.getElementById('downloadBtn').addEventListener('click', downloadGcode);
            
            // 快速範例按鈕
            document.querySelectorAll('.char-buttons button').forEach(button => {
                button.addEventListener('click', (e) => {
                    const char = e.target.dataset.char;
                    document.getElementById('textInput').value = char;
                    showFontPreview();
                });
            });
            
            // 文字輸入變化時更新預覽
            document.getElementById('textInput').addEventListener('input', showFontPreview);
            
            // 參數變化時更新預覽
            document.getElementById('pixelSize').addEventListener('input', showFontPreview);
            document.getElementById('blockHeight').addEventListener('input', showFontPreview);
            document.getElementById('printStyle').addEventListener('change', showFontPreview);
            
            // 初始顯示預覽
            showFontPreview();
        });
    </script>
</body>
</html>